

interface IWeek {
   first: Date;
   last: Date;
}

let week: IWeek[] = [];
let month: number;
let year: number;
let lastDay: number;
let dayOfWeek: number;
let first: Date;
let day: number;
let nextMonth: number;

month = 0; //new Date().getMonth();
year = new Date().getFullYear();
lastDay = new Date(year, month, 0).getDate();

let xx: number = new Date(year, month, lastDay).getDay();
nextMonth = 7 - new Date(year, month, lastDay).getDay();

for(day = 1; day <= lastDay; day++) {
   dayOfWeek = new Date(year, month, day).getDay();
   if(week.length === 0 && first === undefined)
      first = new Date(year, month, day, 0, 0, 0);
   else if(dayOfWeek === 1)
      first = new Date(year, month, day, 0, 0, 0);
   else if(dayOfWeek === 0) {
      week.push({
         first: first,
         last: new Date(year, month, day, 23, 59, 59)
      });
      first = undefined;
   }
}

if(first !== undefined) {
   week.push({
      first: first,
      last: new Date(year, month, lastDay, 23, 59, 59)
   });
}

/*if(nextMonth !== 0 && first !== undefined) {
   month++;
   for(day = 1; day <= nextMonth; day++) {
      dayOfWeek = new Date(year, month, day).getDay();
      if(dayOfWeek === 0) {
         week.push({
            first: first,
            last: new Date(year, month, day, 23, 59, 59)
         });
         first = undefined;
      }
   }
}*/

for(let w of week)
   console.log(w.first + "/" + w.last);


   import {CInit} from "./core/CInit";
   let i: CInit = new CInit();
   i.search();

with
   activity_cte as (
      select main.activity.id,
             main.activity.description,
             main.activity.internal_ref,
             main.activity.external_ref,
             main.activity.hour,
             main.activity.wbs
      from main.activity ),
   workday_cte as (
      select main.workday.activity, sum(main.workday.hour) as total
      from main.workday
      group by main.workday.activity),
   request_cte as (
      select main.request.activity, count(main.request.id) as request
      from main.request
      GROUP BY main.request.activity),
   wbs_cte as (
      select main.wbs.id, main.wbs.description1
      from main.wbs )
select activity_cte.id,
       activity_cte.description,
       activity_cte.internal_ref,
       activity_cte.external_ref,
       activity_cte.hour,
       wbs_cte.id as wbs,
       wbs_cte.description1 as dwbs,
       request_cte.request,
       workday_cte.total
from activity_cte
        CROSS JOIN workday_cte on workday_cte.activity = activity_cte.id
        CROSS JOIN request_cte on request_cte.activity = activity_cte.id
        CROSS JOIN wbs_cte on wbs_cte.id = activity_cte.wbs